<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.8/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.8/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.8/dist/index.js"></script><script>(()=>{setTimeout(()=>{const{markmap:x,mm:K}=window,P=new x.Toolbar;P.attach(K);const F=P.render();F.setAttribute("style","position:absolute;bottom:20px;right:20px"),document.body.append(F)})})()</script><script>((b,L,T,D)=>{const H=b();window.mm=H.Markmap.create("svg#mindmap",(L||H.deriveOptions)(D),T)})(()=>window.markmap,null,{"content":".gitlab-ci.yml - Mapeamento do Fluxo","children":[{"content":"Inclusão de Templates","children":[{"content":"Utiliza templates para herdar configurações:","children":[{"content":"<code>include</code>:","children":[{"content":"<code>project: mpf/arquitetura-devops/ci-cd/gitflow</code>: Define o projeto para uso do template gitflow.","children":[{"content":"<code>ref: base-latest</code>: Define a versão do template gitflow.","children":[],"payload":{"tag":"li","lines":"6,7"}},{"content":"<code>file: /templates/.gitlab-ci-gitflow.yml</code>: Define o local do template gitflow.","children":[],"payload":{"tag":"li","lines":"7,8"}}],"payload":{"tag":"li","lines":"5,8"}},{"content":"<code>project: mpf/arquitetura-devops/ci-cd/kubernetes-deploy</code>: Define o projeto para uso do template kubernetes-deploy.","children":[{"content":"<code>ref: support/3.x</code>: Define a versão do template kubernetes-deploy.","children":[],"payload":{"tag":"li","lines":"9,10"}},{"content":"<code>file: cd.yaml</code>: Define o local do template kubernetes-deploy.","children":[],"payload":{"tag":"li","lines":"10,11"}}],"payload":{"tag":"li","lines":"8,11"}}],"payload":{"tag":"li","lines":"4,11"}},{"content":"<strong>Justificativa:</strong> Padroniza o pipeline, herdando funções para diversas etapas, como versionamento, deploy e tratamento de merge requests.","children":[],"payload":{"tag":"li","lines":"11,13"}}],"payload":{"tag":"li","lines":"3,13"}}],"payload":{"tag":"h2","lines":"2,3"}},{"content":"Variáveis Globais","children":[{"content":"Define variáveis globais para o pipeline:","children":[{"content":"<code>variables</code>:","children":[{"content":"<code>extends: .variables</code>: Utiliza as variáveis definidas pelo template.","children":[],"payload":{"tag":"li","lines":"16,17"}},{"content":"<code>MAJOR_VERSION: 1</code>: Define a versão major inicial.","children":[],"payload":{"tag":"li","lines":"17,18"}},{"content":"<code>ALLOW_DEV_COMMIT: \"1\"</code>: Habilita o commit direto no dev.","children":[],"payload":{"tag":"li","lines":"18,19"}}],"payload":{"tag":"li","lines":"15,19"}},{"content":"<strong>Justificativa:</strong> Configurações iniciais para o projeto.","children":[],"payload":{"tag":"li","lines":"19,21"}}],"payload":{"tag":"li","lines":"14,21"}}],"payload":{"tag":"h2","lines":"13,14"}},{"content":"Estágios","children":[{"content":"Define os estágios do pipeline:","children":[{"content":"<code>stages</code>:","children":[{"content":"<code>validate</code>: Validar as configurações do projeto, e evitar pipelines concorrentes.","children":[],"payload":{"tag":"li","lines":"24,25"}},{"content":"<code>version</code>: Realizar o bump da versão da aplicação.","children":[],"payload":{"tag":"li","lines":"25,26"}},{"content":"<code>build</code>: Realizar o build da aplicação (maven).","children":[],"payload":{"tag":"li","lines":"26,27"}},{"content":"<code>build_and_release</code>: Cria tag e release da aplicação.","children":[],"payload":{"tag":"li","lines":"27,28"}},{"content":"<code>package</code>: Construir a imagem docker.","children":[],"payload":{"tag":"li","lines":"28,29"}},{"content":"<code>deploy</code>: Realizar o deploy no kubernetes.","children":[],"payload":{"tag":"li","lines":"29,30"}},{"content":"<code>merge_request</code>: Lidar com as merge requests.","children":[],"payload":{"tag":"li","lines":"30,31"}}],"payload":{"tag":"li","lines":"23,31"}},{"content":"<strong>Justificativa:</strong> Organiza o fluxo do pipeline, definindo as etapas.","children":[],"payload":{"tag":"li","lines":"31,33"}}],"payload":{"tag":"li","lines":"22,33"}}],"payload":{"tag":"h2","lines":"21,22"}},{"content":"Versionamento","children":[{"content":"Configura a geração de versão:","children":[{"content":"<code>.bump_version_myvars</code>:","children":[{"content":"<code>extends: .bump_version_variables</code> : Utiliza as variáveis do template.","children":[],"payload":{"tag":"li","lines":"36,37"}},{"content":"<code>P_MAJOR_VERSION: \"${MAJOR_VERSION}\"</code>: Define a variável <code>MAJOR_VERSION</code>.","children":[],"payload":{"tag":"li","lines":"37,38"}}],"payload":{"tag":"li","lines":"35,38"}},{"content":"<code>bump_version</code>:","children":[{"content":"<code>extends: .bump_version</code>: Extende as funcionalidades do template para gerar versão.","children":[],"payload":{"tag":"li","lines":"39,40"}},{"content":"<code>stage: version</code>: Define o estágio em que será executado.","children":[],"payload":{"tag":"li","lines":"40,41"}},{"content":"<code>variables:</code>:","children":[{"content":"Utiliza as variáveis definidas em <code>bump_version_myvars</code>.","children":[],"payload":{"tag":"li","lines":"42,43"}}],"payload":{"tag":"li","lines":"41,43"}}],"payload":{"tag":"li","lines":"38,43"}},{"content":"<strong>Justificativa:</strong> Gera uma versão da aplicação, e habilita a criação de tags e releases, como descrito no gitflow.","children":[],"payload":{"tag":"li","lines":"43,45"}}],"payload":{"tag":"li","lines":"34,45"}}],"payload":{"tag":"h2","lines":"33,34"}},{"content":"Build","children":[{"content":"Define o job de build da aplicação:","children":[{"content":"<code>build</code>:","children":[{"content":"<code>image: maven:3.9.6-eclipse-temurin-17</code>: Utiliza imagem maven para o build.","children":[],"payload":{"tag":"li","lines":"48,49"}},{"content":"<code>stage: build</code>: Define o estágio de build.","children":[],"payload":{"tag":"li","lines":"49,50"}},{"content":"<code>only: - master - dev</code>: Executa o build apenas nas branches <code>master</code> e <code>dev</code>.","children":[],"payload":{"tag":"li","lines":"50,51"}},{"content":"<code>script</code>: Executa o comando maven para o build da aplicação <code>mvn ${MAVEN_CLI_OPTS} -DskipTests clean package</code>.","children":[],"payload":{"tag":"li","lines":"51,52"}}],"payload":{"tag":"li","lines":"47,52"}},{"content":"<strong>Justificativa:</strong> Utiliza o maven para gerar um <code>.war</code> do projeto.","children":[],"payload":{"tag":"li","lines":"52,54"}}],"payload":{"tag":"li","lines":"46,54"}}],"payload":{"tag":"h2","lines":"45,46"}},{"content":"Build &amp; Release","children":[{"content":"Configura a tag da release e executa um passo após o build:","children":[{"content":"<code>build_and_release</code>:","children":[{"content":"<code>extends: .release_tag_aftscript</code>: Utiliza o template de tag do gitflow.","children":[],"payload":{"tag":"li","lines":"57,58"}},{"content":"<code>stage: build_and_release</code>: Define o estágio.","children":[],"payload":{"tag":"li","lines":"58,59"}},{"content":"<code>script: - echo \"SUCCESS\" &gt; ${CI_PROJECT_DIR}/.job_status</code>: Cria arquivo de status do job.","children":[],"payload":{"tag":"li","lines":"59,60"}}],"payload":{"tag":"li","lines":"56,60"}},{"content":"<strong>Justificativa:</strong> Cria uma tag para o repositório git com a versão definida.","children":[],"payload":{"tag":"li","lines":"60,62"}}],"payload":{"tag":"li","lines":"55,62"}}],"payload":{"tag":"h2","lines":"54,55"}},{"content":"Package (Template)","children":[{"content":"Configura o processo de empacotamento da imagem docker:","children":[{"content":"<code>.tpl:package</code>:","children":[{"content":"<code>stage: package</code>: Define o estágio de package.","children":[],"payload":{"tag":"li","lines":"65,66"}},{"content":"<code>image: docker:stable</code>: Define que utiliza a imagem padrão do docker.","children":[],"payload":{"tag":"li","lines":"66,67"}},{"content":"<code>variables</code>: Define algumas variáveis de build da imagem.","children":[{"content":"<code>DOCKER_HOST</code>: Conecta ao docker daemon","children":[],"payload":{"tag":"li","lines":"68,69"}},{"content":"<code>DOCKER_TLS_CERTDIR</code>: Define que não tem certificados ssl.","children":[],"payload":{"tag":"li","lines":"69,70"}},{"content":"<code>IMAGE_TAG</code>: Define a tag da imagem.","children":[],"payload":{"tag":"li","lines":"70,71"}}],"payload":{"tag":"li","lines":"67,71"}},{"content":"<code>services</code>: Utiliza docker in docker para construir a imagem.","children":[],"payload":{"tag":"li","lines":"71,72"}},{"content":"<code>before_script</code>: realiza o login no registry, após uma espera de 15 segundos.","children":[],"payload":{"tag":"li","lines":"72,73"}},{"content":"<code>script</code>: Define a forma de construção da imagem.","children":[{"content":"Constrói o arquivo docker, passando variáveis (versão, arquivo de versão, nome do arquivo <code>.war</code> e porta) como parâmetros.","children":[],"payload":{"tag":"li","lines":"74,75"}},{"content":"Realiza o push da imagem no registry.","children":[],"payload":{"tag":"li","lines":"75,76"}},{"content":"Cria um arquivo de sucesso.","children":[],"payload":{"tag":"li","lines":"76,77"}}],"payload":{"tag":"li","lines":"73,77"}}],"payload":{"tag":"li","lines":"64,77"}},{"content":"<strong>Justificativa:</strong> Garante que a imagem seja construída de forma consistente e padronizada.","children":[],"payload":{"tag":"li","lines":"77,79"}}],"payload":{"tag":"li","lines":"63,79"}}],"payload":{"tag":"h2","lines":"62,63"}},{"content":"Package (Implantações)","children":[{"content":"Define as implantações das imagens:","children":[{"content":"<code>package:dev</code> e <code>package</code>:<br>\n*    Extende o template <code>.tpl:package</code>, de acordo com a tag do commit, definindo um prefixo para imagens de dev e sem prefixo para master.","children":[{"content":"<code>script</code>:","children":[{"content":"Constrói o arquivo docker, passando as variáveis (versão, arquivo de versão, nome do arquivo <code>.war</code> e porta) como parâmetros.","children":[],"payload":{"tag":"li","lines":"84,85"}},{"content":"Publica a imagem no registry.","children":[],"payload":{"tag":"li","lines":"85,86"}},{"content":"Cria um arquivo de status do job.","children":[],"payload":{"tag":"li","lines":"86,87"}}],"payload":{"tag":"li","lines":"83,87"}}],"payload":{"tag":"li","lines":"81,87"}},{"content":"<strong>Justificativa:</strong> Permite construir imagens diferentes, de acordo com o ambiente.","children":[],"payload":{"tag":"li","lines":"87,89"}}],"payload":{"tag":"li","lines":"80,89"}}],"payload":{"tag":"h2","lines":"79,80"}},{"content":"Deploy (Templates)","children":[{"content":"Configura o deploy no kubernetes, utilizando o template <code>kubernetes-deploy</code>:","children":[{"content":"<code>.tpl:deploy</code>: Define o template para o deploy.","children":[{"content":"<code>cache</code>: Define um cache para o deploy.","children":[],"payload":{"tag":"li","lines":"92,93"}},{"content":"<code>.tpl:deploy:vars</code>: Define algumas variáveis necessárias para o deploy:","children":[{"content":"<code>K8S_KUBE_NAMESPACE</code>: Define o namespace para o deploy.","children":[],"payload":{"tag":"li","lines":"94,95"}},{"content":"<code>K8S_HELM_RELEASE_NAME</code>: Define o nome da release do helm.","children":[],"payload":{"tag":"li","lines":"95,96"}},{"content":"<code>K8S_HELM_ATOMIC_FLAG</code>: Define a flag do helm que controla o modo atomico.","children":[],"payload":{"tag":"li","lines":"96,97"}},{"content":"<code>K8S_HELM_APP_VERSION</code>: Define a versão da aplicação a ser deployada.","children":[],"payload":{"tag":"li","lines":"97,98"}},{"content":"<code>K8S_HELM_VALUES_FILE</code>: Define o arquivo de valores do chart do helm.","children":[],"payload":{"tag":"li","lines":"98,99"}}],"payload":{"tag":"li","lines":"93,99"}}],"payload":{"tag":"li","lines":"91,99"}},{"content":"<code>.tpl:deploy:run</code>:","children":[{"content":"Utiliza o template <code>.k8s:tpl:run</code> e <code>.tpl:deploy</code> para o processo de deploy.","children":[],"payload":{"tag":"li","lines":"100,101"}},{"content":"Define o endereço da aplicação com o parâmetro <code>environment.url</code>.","children":[],"payload":{"tag":"li","lines":"101,102"}}],"payload":{"tag":"li","lines":"99,102"}},{"content":"<code>.tpl:deploy:stop</code>:","children":[{"content":"Utiliza o template <code>.k8s:tpl:stop</code> e <code>.tpl:deploy</code> para o processo de stop.","children":[],"payload":{"tag":"li","lines":"103,104"}}],"payload":{"tag":"li","lines":"102,104"}},{"content":"<strong>Justificativa:</strong> Configura um template para o processo de deploy, usando as configurações padrão do seu ambiente.","children":[],"payload":{"tag":"li","lines":"104,106"}}],"payload":{"tag":"li","lines":"90,106"}}],"payload":{"tag":"h2","lines":"89,90"}},{"content":"Deploy (Implantações)","children":[{"content":"Define os processos de deploy para os ambientes de dev e prod:","children":[{"content":"<code>tpl:deploy:kb-dev</code>:<br>\n* Extende o template <code>.k8s:default:kb-dev</code> e o <code>.tpl:deploy</code>, customizando as variáveis necessárias para o ambiente.","children":[{"content":"<code>run:deploy:kb-dev</code> e <code>stop:deploy:kb-dev</code>","children":[{"content":"Executa o deploy para o ambiente de <code>kb-dev</code>.","children":[],"payload":{"tag":"li","lines":"111,112"}}],"payload":{"tag":"li","lines":"110,112"}}],"payload":{"tag":"li","lines":"108,112"}},{"content":"<code>tpl:deploy:kb-prod</code>:<br>\n* Extende o template <code>.k8s:default:kb-prod</code> e o <code>.tpl:deploy</code>, customizando as variáveis necessárias para o ambiente.","children":[{"content":"<code>run:deploy:kb-prod</code> e <code>stop:deploy:kb-prod</code>","children":[{"content":"Executa o deploy para o ambiente de <code>kb-prod</code>.","children":[],"payload":{"tag":"li","lines":"115,116"}}],"payload":{"tag":"li","lines":"114,116"}},{"content":"<code>when: manual</code>: O deploy de produção é manual.","children":[],"payload":{"tag":"li","lines":"116,117"}}],"payload":{"tag":"li","lines":"112,117"}},{"content":"<strong>Justificativa:</strong> Define configurações específicas de deploy para os ambientes de desenvolvimento e produção, com o uso dos templates e variáveis.","children":[],"payload":{"tag":"li","lines":"117,119"}}],"payload":{"tag":"li","lines":"107,119"}}],"payload":{"tag":"h2","lines":"106,107"}},{"content":"Merge Request","children":[{"content":"Configura a ação de merge request:","children":[{"content":"<code>.mr_to_dev_myvars</code>, <code>.mr_beta_to_master_myvars</code>:","children":[{"content":"Utiliza as variáveis do template.","children":[],"payload":{"tag":"li","lines":"122,123"}}],"payload":{"tag":"li","lines":"121,123"}},{"content":"<code>mr_to_dev</code>, <code>mr_hotfix_to_master</code>, <code>mr_hotfeat_to_dev</code> e <code>mr_beta_to_master</code>:","children":[{"content":"Extende os jobs de merge request do gitflow, customizando o code review e outros parâmetros.","children":[],"payload":{"tag":"li","lines":"124,125"}}],"payload":{"tag":"li","lines":"123,125"}},{"content":"<strong>Justificativa:</strong> Garante que os merges request sejam realizados de acordo com o gitflow.","children":[],"payload":{"tag":"li","lines":"125,127"}}],"payload":{"tag":"li","lines":"120,127"}},{"content":"","children":[{"content":"1. <strong>Acesse o Site:</strong> Vá para https://markmap.js.org/repl.","children":[],"payload":{"tag":"li","lines":"129,130","listIndex":1}},{"content":"2. <strong>Cole o Código:</strong> Cole o código Markmap acima na caixa de texto.","children":[],"payload":{"tag":"li","lines":"130,131","listIndex":2}},{"content":"3. <strong>Visualize o Mapa:</strong> O mapa mental será gerado automaticamente.","children":[],"payload":{"tag":"li","lines":"131,133","listIndex":3}}],"payload":{"tag":"ol","lines":"129,133"}}],"payload":{"tag":"h2","lines":"119,120"}}],"payload":{"tag":"h1","lines":"0,1"}},null)</script>
</body>
</html>
